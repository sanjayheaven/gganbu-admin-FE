var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,s=(e,a)=>{for(var t in a||(a={}))l.call(a,t)&&n(e,t,a[t]);if(r)for(var t of r(a))i.call(a,t)&&n(e,t,a[t]);return e},o=(e,r)=>a(e,t(r));import{F as d}from"./filterAction.ac6bc61d.js";import{V as c,u as m,P as u,z as f,R as p,S as h,U as b,b3 as g,ab as v,J as y,aZ as x}from"./index.1febd9c7.js";import{a as I,T as j}from"./Table.fbba7f07.js";import{u as w,a as C,b as N,c as S}from"./index.6bf8d4e0.js";import{u as O}from"./useTablePagination.b5d70291.js";import{u as k,a as A}from"./index.b744983c.js";import{S as P}from"./index.7c1d10d5.js";import{C as R}from"./index.efa84ac2.js";var D=e=>{var a=e,{selectedItem:t,setSelectedItem:n}=a,d=((e,a)=>{var t={};for(var n in e)l.call(e,n)&&a.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&r)for(var n of r(e))a.indexOf(n)<0&&i.call(e,n)&&(t[n]=e[n]);return t})(a,["selectedItem","setSelectedItem"]);return m(u,o(s({},d),{className:"min-w-max",children:[f(p,{labelCol:{span:3},children:h([{label:"Name",required:!0,children:f(b,{value:t.name,onChange:e=>n(o(s({},t),{name:e.target.value}))})},{label:"Desc",required:!0,children:f(b.TextArea,{value:t.desc,onChange:e=>n(o(s({},t),{desc:e.target.value}))})}])}),m("div",{className:" grid grid-cols-3 mt-5 gap-4 ",children:[f("div",{className:"text-lg font-bold ",children:"Route Auth"}),f("div",{className:"text-lg font-bold ",children:"Content Auth"})]}),m("div",{className:"grid grid-cols-3 mt-5 gap-4 max-h-[40vh] overflow-auto",children:[f(I,{onCheck:e=>n(o(s({},t),{routeAuth:e})),checkedKeys:t.routeAuth,fieldNames:{key:"path"},checkable:!0,treeData:g}),f("div",{})]})]}))},z=()=>{const{filter:e,setFilter:a}=w({}),{pagination:t,setPagination:r}=O(),{selectedItem:l,setSelectedItem:i}=k({}),{modal:n,setModal:p}=A({}),{data:g,setData:I}=C([]),{loading:z,setLoading:E}=N(!1),{t:T}=v(),_=async a=>{E(!0);try{const l=await(e=>c.get("/roles/getRoles",{params:e}))(o(s({},e),{current:(null==a?void 0:a.current)||t.current,pageSize:(null==a?void 0:a.pageSize)||t.pageSize})),{items:i=[],total:n}=l;E(!1),I(i),r(o(s(s({},t),a||{}),{total:n}))}catch(l){}},q=async()=>{const{name:e}=l;if(!e)return x.error("Please finish all required info");try{l._id?await((e,a)=>c.post("/roles/updateRole",s({roleId:e},a)))(l._id,l):await(e=>c.post("/roles/createRole",e))(l),p(o(s({},n),{visible:!1})),await _()}catch(a){}};S(e,(()=>_(o(s({},t),{current:1}))));const F=[{title:"Name",dataIndex:"name"},{title:"Desc",dataIndex:"desc"},{title:"Staff Count",dataIndex:"staffCount"},{title:"Action",dataIndex:"action",render:(e,a)=>m(P,{children:[f("a",{onClick:()=>{i(s({},a)),p(o(s({},n),{visible:!0,title:"Edit"}))},children:"Edit"}),f("a",{className:"text-red-600",onClick:()=>{u.confirm({content:"Sure to delete this item?",onOk:async()=>{try{await(e=a._id,c.post("/roles/deleteRole",{roleId:e})),await _()}catch(t){}var e}})},children:"Delete"})]})}].map((e=>o(s({},e),{key:e.dataIndex})));return m("div",{children:[f(R,{className:"mb-4",children:m("div",{className:"grid grid-cols-4 gap-4",children:[h([{label:T("SEARCH"),className:"mb-0",children:f(b,{value:e.name,onChange:t=>a(o(s({},e),{name:t.target.value})),placeholder:"name/desc"})}]),f(d,{className:"mb-0",onQuery:()=>_(),onReset:()=>a({})})]})}),f(R,{title:f(y,{onClick:()=>{p(o(s({},n),{title:"Add",visible:!0})),i({})},type:"primary",children:"+ New Role"}),children:f(j,{rowKey:e=>e._id,onChange:e=>_(e),pagination:t,loading:z,columns:F,dataSource:g})}),f(D,o(s({selectedItem:l,setSelectedItem:i},n),{onOk:()=>q()}))]})};export{z as default};
